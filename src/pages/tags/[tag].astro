---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
    const posts = await getCollection('blog'); // o 'blogs', se la tua collection si chiama cosÃ¬
    const allTags = [...new Set(posts.flatMap((p) => [...(p.data.tags || []), ...(p.data.extratags || [])]))];
    return allTags.map((tag) => ({ params: { tag } }));
}

export async function get({ params }) {
    const { tag } = params;
    const posts = await getCollection('blog'); // o 'blogs'
    const filtered = posts.filter((p) => (p.data.tags || []).includes(tag) || (p.data.extratags || []).includes(tag));
    return { props: { tag, filtered } };
}

const { tag, filtered } = Astro.props;
---

<Layout title={`Post con tag: #${tag}`}>
    <section class="max-w-4xl mx-auto mb-16">
        <h1 class="text-3xl font-bold text-[#f2f2f2] mb-8">#{tag}</h1>

        {
            filtered.length > 0 ? (
                <ul class="space-y-6">
                    {filtered.map((post) => (
                        <li>
                            <a href={`/blogs/${post.slug}`} class="post-link">
                                <strong>{post.data.title}</strong>
                                <br />
                                <span class="text-[#999] text-sm">{post.data.description}</span>
                            </a>
                        </li>
                    ))}
                </ul>
            ) : (
                <p class="text-[#888]">Nessun post con questo tag.</p>
            )
        }
    </section>

    <style>
        .post-link {
            display: block;
            color: #b8b8b8;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        .post-link:hover {
            color: #00bcd4;
        }
    </style>
</Layout>
